# Zrealizowane działania portu macOS

- Utworzono moduł `Platform/PathProvider` zapewniający wieloplatformową obsługę katalogów użytkownika (AppData/Application Support) oraz narzędzie `ensureDirectoryExists` do bezpiecznego tworzenia struktur katalogów.
- Zastąpiono w `NppParameters` bezpośrednie odwołania do `SHGetFolderPath` i ręcznych wywołań `CreateDirectory` integracją z nowym modułem platformowym i przygotowano fallbacki dla środowiska macOS.
- Dostosowano `PluginsAdmin` oraz testowy kod `FunctionList` do korzystania z nowego interfejsu ścieżek, ograniczając dalsze zależności od stałych `CSIDL` i przygotowując grunt pod kompilację poza Windows.
- Opracowano dokument `docs/macos/architecture_assessment.md` klasyfikujący moduły PowerEditor, Scintilla i Lexilla pod kątem przenośności oraz mapujący zależności od Win32 na odpowiedniki macOS wraz z analizą ryzyk dla portu; zadania w sekcji analitycznej planu zostały zaktualizowane jako ukończone.
- Opracowano dokument `docs/macos/build_system_plan.md` opisujący podział projektów CMake, cele platformowe (Windows/macOS), plan tworzenia pakietu `.app` oraz integrację CI, jednocześnie potwierdzając dostępność backendu Cocoa w Scintilli i neutralny platformowo kod Lexilli.
- Dodano moduł `Platform/FileSystem` zapewniający wieloplatformowe operacje na ścieżkach (łączenie, weryfikacja i usuwanie plików/katalogów) oraz włączono go do konfiguracji CMake i projektu Visual Studio.
- Przebudowano obsługę katalogu chmury w `NppParameters`, zastępując bezpośrednie wywołania WinAPI nowym API platformowym `combinePath`, `ensureDirectoryExists`, `fileExists` i `removeFile`, aby ujednolicić przygotowanie ścieżek pod macOS.
- Przygotowano dokument `docs/macos/ui_strategy.md` porównujący Cocoa i toolkity wieloplatformowe oraz opisujący plan migracji UI z warstwą abstrakcji `npp::ui` i mostkami eventów.
- Opracowano roadmapę `docs/macos/port_roadmap.md` z fazami iteracyjnego portu, kamieniami milowymi i wskaźnikami jakości, aktualizując plan `macOS_convert_todo.md` o zakończone zadanie harmonogramu.
- Zrefaktoryzowano tworzenie katalogów w `Buffer.cpp`, `Notepad_plus.cpp`, `Notepad_plus_Window.cpp` i `NppIO.cpp`, zastępując wywołania WinAPI funkcjami `npp::platform::ensureDirectoryExists` i `combinePath`, aby przygotować kod do budowy poza Windows.
- Uaktualniono strategię UI w `docs/macos/ui_strategy.md`, wybierając Qt 6.x z motywem Liquid Glass jako warstwę prezentacji oraz dodając nowe zadania w `macOS_convert_todo.md` dotyczące modułu `npp::ui` i prototypu Qt.
- Rozszerzono moduł `Platform/PathProvider` o katalog tymczasowy (`KnownDirectory::Temporary`) i zintegrowano go z logiką zapisu w `Buffer.cpp`, eliminując bezpośrednie wywołania `GetTempPath` oraz zastępując obliczanie znaczników czasu implementacją w `std::chrono` zgodną z macOS.
- Przygotowano dokument `docs/macos/system_services_matrix.md` mapujący zależności Win32 na odpowiedniki w macOS wraz ze strategią użycia w warstwie `npp::platform` i priorytetami integracji.
- Stworzono przewodnik `docs/macos/developer_environment.md` opisujący wymagane narzędzia, konfigurację repozytorium, procedurę bootstrap i walidację jakości dla zespołu pracującego nad portem macOS; oznaczono odpowiadające zadania w planie jako wykonane.
- Zaktualizowano `README.md`, aby przedstawić repozytorium jako projekt portu Notepad++ na macOS, podkreślając strategię UI/UX, dokumentację oraz wymogi jakościowe i testowe.
- Przebudowano obsługę awaryjnego zapisu w `winmain.cpp`, korzystając z `npp::platform::pathFor`, `combinePath` i `ensureDirectoryExists` zamiast `GetTempPath`, aby mechanizm odzyskiwania dokumentów działał na macOS i innych systemach.
- Wprowadzono konfigurację testów jednostkowych Catch2 (`tests/unit/CMakeLists.txt`) oraz pierwszy pakiet testów dla modułu platformowego (`tests/unit/platform/test_path_provider.cpp`), zapewniając walidację operacji na ścieżkach i plikach niezależnie od systemu operacyjnego.
- Skonfigurowano workflow GitHub Actions `macOS Port CI` uruchamiający budowę i testy modułów platformowych na hostach macOS, wprowadzając automatyczną walidację cross-platform oraz aktualizując plan działań o kolejne etapy publikacji pakietów `.app`.
- Utworzono moduł `Platform/SettingsLocator` określający katalogi ustawień i wtyczek z wykorzystaniem `PathProvider`, aby kierować macOS na `~/Library/Application Support/Notepad++`, oraz zrefaktoryzowano `NppParameters::load()` do korzystania z nowych ścieżek z walidacją tworzenia katalogów.
- Dodano testy jednostkowe `test_settings_locator.cpp` w pakiecie platformowym weryfikujące scenariusze lokalnej i użytkownika macOS, rozszerzając konfigurację CMake/Visual Studio o nowy moduł oraz oznaczono zadanie planu konfiguracji preferencji jako ukończone.
- Rozszerzono moduł `Platform/FileSystem` o funkcje `fileSize` i `copyFile`, zrefaktoryzowano logikę `NppParameters` do korzystania z nich zamiast `CopyFile` oraz dodano testy jednostkowe weryfikujące kopiowanie i raportowanie rozmiarów plików niezależnie od platformy.
- Utworzono katalog `PowerEditor/macos` z konfiguracją CMake i natywnym szkieletem Cocoa generującym pakiet `NotepadPlusPlusPreview.app`, aby potwierdzić przepływ budowy przyszłego UI Liquid Glass na macOS.
- Przebudowano workflowi CI: ograniczono publikację artefaktów Windows do wydań tagowanych oraz dodano w `macOS Port CI` kroki budowy i archiwizacji podglądowego pakietu `.app`, co zamyka zadanie rozbudowy pipeline macOS o dystrybucję.
- Utworzono moduł `Platform/SystemInfo` dostarczający informacje o systemie i wyświetlaczach niezależnie od platformy oraz zrefaktoryzowano `DebugInfoDlg`, aby korzystał z tej warstwy zamiast bezpośrednich wywołań WinAPI, przygotowując fallback dla macOS.

- Opracowano plan migracji preferencji w dokumencie `docs/macos/registry_migration_plan.md`, mapując klucze rejestru Windows na preferencje macOS, definiując interfejs `PreferencesStore`, migratory oraz wymagania testowe; odpowiednie zadanie w planie oznaczono jako ukończone i dodano kolejne etapy implementacji.
- Zaprojektowano i wdrożono moduł `Platform/SystemServices` wprowadzający interfejsy abstrakcji usług systemowych (schowek, monitorowanie plików) z referencyjną implementacją dla Windows i wieloplatformowym stubem, aktualizując konfiguracje CMake/Visual Studio oraz dodając testy jednostkowe `test_system_services.cpp` weryfikujące logikę masek i zachowanie stuba.
- Zrefaktoryzowano funkcje `str2Clipboard` i `strFromClipboard` w module `MISC/Common`, aby używały `npp::platform::SystemServices::clipboard()` zamiast bezpośredniego WinAPI, co upraszcza testowanie i przybliża kod do uruchomienia na macOS.
- Przepisano monitorowanie zmian plików w `NppIO.cpp`, wykorzystując `npp::platform::SystemServices::createFileWatcher()` i nowy moduł `FileChangePoller` oparty na `std::filesystem`, aby wyeliminować bezpośrednie zależności od `ReadDirectoryChangesW` i przygotować logikę auto-odświeżania do działania na macOS.
- Dodano moduł `Platform/FileChangePoller` oraz testy jednostkowe `test_file_change_poller.cpp`, które weryfikują wykrywanie zmian rozmiaru, usunięć i ponownego pojawienia się plików w sposób niezależny od systemu.
- Zaprojektowano interfejs `npp::platform::PreferencesStore` udostępniany przez `SystemServices`, dodając implementację pamięciową dla środowisk wieloplatformowych oraz backend rejestru Windows, a także pokrywając go testami `test_preferences_store.cpp` weryfikującymi obsługę typów prostych i scenariuszy usuwania.
- Zrefaktoryzowano `NppParameters`, aby podczas ładowania i zapisywania konfiguracji synchronizował kluczowe ustawienia GUI i kopii zapasowych z `npp::platform::PreferencesStore`, zapewniając warstwę preferencji niezależną od rejestru Windows i przygotowaną do backendu macOS.
- Dodano moduł `Platform/PreferencesSync`, który centralizuje zapis i uzupełnianie brakujących wartości GUI/backup w `PreferencesStore`, oraz pokryto go testami jednostkowymi `test_preferences_sync.cpp` weryfikującymi migrację danych i scenariusze brzegowe.
- Wprowadzono `NppParameters::backfillPreferencesStore()`, aby podczas odczytu `config.xml` zasilić nowe API preferencji wartościami domyślnymi z pliku konfiguracyjnego przed zastosowaniem nadpisów, co minimalizuje ryzyko niespójności przy pierwszym uruchomieniu poza Windows.
- Utworzono moduł `Platform/PreferencesMigrator` importujący ustawienia z `config.xml` i eksportów `.reg` do `PreferencesStore`, zintegrowano go w `NppParameters` (automatyczne wyszukiwanie pliku `preferences*.reg`) oraz dodano testy `test_preferences_migrator.cpp` pokrywające scenariusze migracji i ochronę istniejących wartości.
- Przygotowano przewodnik `docs/macos/preferences_plugin_api.md` dokumentujący komunikaty `NPPM_PREFERENCES_*`, konwencje domen i przykładowe implementacje wtyczek wraz z checklistą migracyjną.
- Opracowano strategię aktualizacji macOS w dokumencie `docs/macos/update_strategy.md`, definiując interfejs `npp::platform::Updater`, backend oparty o `NSURLSession`/Sparkle, wymogi bezpieczeństwa (podpisy, TLS) oraz plan migracji `PluginsAdmin` z `gup.exe`.
- Wprowadzono moduł `Platform/SystemAppearance` dostarczający preferowany motyw systemowy poprzez `preferredColorScheme()`, zrefaktoryzowano `NppDarkMode` do korzystania z nowego API (w tym obsługę macOS przez `CFPreferencesCopyAppValue`) oraz dodano test `test_system_appearance.cpp` weryfikujący poprawność wartości enum.
- Zastąpiono logikę "View in Browser" abstrakcją `Platform/ApplicationLauncher` (Windows: reużycie App Paths, macOS: `LSFindApplicationForInfo`/`LSOpenCFURLRef`), przebudowano `NppCommands` do korzystania z nowego API i utrzymano komunikaty o błędzie w przypadku braku przeglądarki.
- Przygotowano dokument `docs/macos/plugin_api_compatibility.md` mapujący istniejące API wtyczek, definiujący warstwę `MessageBridge/UiBridge/PluginLoader` oraz plan migracji komunikatów `NPPM_*`/`SCNotification` na macOS.
- Opracowano dokument `docs/macos/docking_strategy.md` opisujący nową warstwę dokowania (`DockingManagerBridge` + `DockingHost` w Qt/AppKit), plan migracji layoutu oraz API kompatybilności dla wtyczek.
- Przygotowano analizę portowania wtyczek (`docs/macos/plugin_porting_assessment.md`) obejmującą ranking popularnych rozszerzeń, bariery WinAPI oraz plan wsparcia (SDK macOS, webinaria, narzędzia audytu).
- Dodano narzędzie `tools/validate_plugin_manifest.py` weryfikujące manifesty wtyczek (schemat JSON, semver, SHA-256, podpis) i przykładowy manifest testowy; zaktualizowano strategię dystrybucji o fazę narzędzi deweloperskich.
- Opracowano plan komunikacji (`docs/macos/communication_plan.md`) definiujący kanały, harmonogram ogłoszeń, materiały wspierające i działania angażujące społeczność portu macOS.
- Przygotowano szablony zgłoszeń macOS (`.github/ISSUE_TEMPLATE/macos-bug-report.yml`, `macos-feature-request.yml`) oraz zaktualizowano konfigurację issue tracker'a, aby kierować użytkowników do właściwych kanałów.
- Zdefiniowano bibliotekę stylów Liquid Glass w `docs/macos/liquid_glass_tokens.md`, obejmującą tokeny kolorów, typografię, spacing, komponenty referencyjne i plan generatora QSS/QML.
- Dodano źródło tokenów (`design/tokens/liquid_glass.json`) oraz generator `tools/generate_liquid_glass_qss.py`, który produkuje styl `resources/ui/liquid_glass.qss` na podstawie dokumentu Liquid Glass.
- Zaprojektowano warstwę `npp::ui`: dodano specyfikację `docs/macos/npp_ui_module_spec.md`, wprowadzono nagłówki interfejsów i fabrykę backendów (`PowerEditor/src/UI/*`), zintegrowano je w systemie budowania oraz przygotowano test `tests/unit/ui/test_ui_factory.cpp`; spójność potwierdzono kompilacją `clang++` (brak `cmake` w środowisku).
- Utworzono prototyp głównego okna Qt: dodano backend `registerQtBackend()` z implementacją `QtApplication/QtWindow/QtDockingHost`, opcjonalnym panelem Function List i menu File/View, przygotowano dokument `docs/macos/qt_main_window_prototype.md` oraz testy `tests/unit/ui/test_ui_qt_backend.cpp`; kompletność potwierdzono kompilacją (`clang++`) i uruchomieniem binarki testowej (`/tmp/npp_ui_tests`).
- Opracowano makiety interfejsu macOS: dokument `docs/macos/macos_ui_mockups.md` opisuje układ głównego okna, menubar, Liquid Toolbar, panele dokowane, panel preferencji oraz wymagania dostępności zgodne z HIG i strategią Liquid Glass.
- Dostosowano Scintillę do kontenera macOS: dodano moduł `UI/ScintillaTheme` z obsługą Liquid Glass/HiDPI, zastąpiono placeholder edytora w `QtBackend.cpp` integracją `ScintillaEdit` z kontrolerem motywu/zoomu oraz przygotowano dokument `docs/macos/scintilla_cocoa_integration.md` opisujący podejście.
- Wprowadzono obsługę skrótów Command/Option: moduł `UI/ShortcutNormalization` konwertuje definicje Windows→macOS, `QtShortcutMap` korzysta z nowej logiki, dodano testy `tests/unit/ui/test_shortcut_normalization.cpp` oraz dokument `docs/macos/shortcut_strategy_mac.md` opisujący zasady migracji i dalsze kroki; zmiany zweryfikowano kompilacją i uruchomieniem pakietu testów `npp_ui_tests`.
- Zaprojektowano multiplatformowy manager kart: dodano interfejs `UI/Tabs.h`, opracowano dokument `docs/macos/tab_manager_strategy.md` opisujący migrację `TabBarPlus` na NSTabView/Qt oraz plan integracji z Liquid Glass i multi-view.
- Zaktualizowano `CONTRIBUTING.md` o sekcję dla deweloperów macOS obejmującą narzędzia (Xcode/CMake/Qt), zasady warstwy abstrakcji `npp::ui`, wymagane walidacje (`ctest`, `npp_ui_tests`) oraz odwołania do dokumentów w `docs/macos/`.
- Przygotowano plan testów integracyjnych NSDocumentController: dokument `docs/macos/nsdocumentcontroller_tests.md` opisuje scenariusze XCTest, wymagania środowiskowe i integrację CI; zaktualizowano przewodnik deweloperski o kroki `xcodebuild test`.
- Opracowano plan integracji LaunchServices: dokument `docs/macos/launchservices_registration.md` opisuje neutralny serwis `FileAssociationService`, generowanie `Info.plist`, scenariusze testowe i integrację CI.
